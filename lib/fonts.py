"""
Bitmap fonts for e-paper display.
Clean, crisp fonts designed for high-contrast e-ink displays.

Font format: Each character is stored as (width, height, bytes...)
where bytes are row-major bitmap data (1 bit per pixel, MSB first).
"""

# 24px font - for line names (U4, 49, etc.)
# Characters: 0-9, A-Z, space
# Each char is variable width, 24 pixels tall
FONT_24_HEIGHT = 24

FONT_24 = {
    ' ': (8, bytes([
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    ])),
    '0': (14, bytes([
        0x0f, 0x80, 0x3f, 0xe0, 0x78, 0x78, 0x70, 0x38,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0x70, 0x38, 0x78, 0x78, 0x3f, 0xe0, 0x0f, 0x80,
    ])),
    '1': (10, bytes([
        0x07, 0x00, 0x1f, 0x00, 0x7f, 0x00, 0x77, 0x00,
        0x07, 0x00, 0x07, 0x00, 0x07, 0x00, 0x07, 0x00,
        0x07, 0x00, 0x07, 0x00, 0x07, 0x00, 0x07, 0x00,
        0x07, 0x00, 0x07, 0x00, 0x07, 0x00, 0x07, 0x00,
        0x07, 0x00, 0x07, 0x00, 0x07, 0x00, 0x07, 0x00,
        0x07, 0x00, 0x07, 0x00, 0x7f, 0xc0, 0x7f, 0xc0,
    ])),
    '2': (14, bytes([
        0x1f, 0xc0, 0x3f, 0xe0, 0x70, 0x70, 0x60, 0x38,
        0x00, 0x38, 0x00, 0x38, 0x00, 0x38, 0x00, 0x70,
        0x00, 0xe0, 0x01, 0xc0, 0x03, 0x80, 0x07, 0x00,
        0x0e, 0x00, 0x1c, 0x00, 0x38, 0x00, 0x70, 0x00,
        0x60, 0x00, 0x60, 0x00, 0x60, 0x00, 0x60, 0x00,
        0x60, 0x00, 0x7f, 0xf8, 0x7f, 0xf8, 0x7f, 0xf8,
    ])),
    '3': (14, bytes([
        0x1f, 0x80, 0x3f, 0xe0, 0x70, 0x70, 0x60, 0x38,
        0x00, 0x38, 0x00, 0x38, 0x00, 0x38, 0x00, 0x70,
        0x00, 0xe0, 0x0f, 0xc0, 0x0f, 0xc0, 0x00, 0xe0,
        0x00, 0x70, 0x00, 0x38, 0x00, 0x38, 0x00, 0x38,
        0x00, 0x38, 0x00, 0x38, 0x00, 0x38, 0x60, 0x38,
        0x70, 0x70, 0x78, 0xf0, 0x3f, 0xe0, 0x0f, 0x80,
    ])),
    '4': (14, bytes([
        0x00, 0xe0, 0x01, 0xe0, 0x03, 0xe0, 0x07, 0xe0,
        0x06, 0xe0, 0x0c, 0xe0, 0x1c, 0xe0, 0x38, 0xe0,
        0x30, 0xe0, 0x60, 0xe0, 0xe0, 0xe0, 0xff, 0xfc,
        0xff, 0xfc, 0xff, 0xfc, 0x00, 0xe0, 0x00, 0xe0,
        0x00, 0xe0, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0xe0,
        0x00, 0xe0, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0xe0,
    ])),
    '5': (14, bytes([
        0x7f, 0xf0, 0x7f, 0xf0, 0x7f, 0xf0, 0x60, 0x00,
        0x60, 0x00, 0x60, 0x00, 0x60, 0x00, 0x60, 0x00,
        0x6f, 0x80, 0x7f, 0xe0, 0x70, 0x70, 0x00, 0x38,
        0x00, 0x38, 0x00, 0x1c, 0x00, 0x1c, 0x00, 0x1c,
        0x00, 0x1c, 0x00, 0x1c, 0x00, 0x38, 0x60, 0x38,
        0x70, 0x70, 0x78, 0xf0, 0x3f, 0xe0, 0x0f, 0x80,
    ])),
    '6': (14, bytes([
        0x07, 0xc0, 0x1f, 0xe0, 0x38, 0x70, 0x70, 0x38,
        0x60, 0x00, 0x60, 0x00, 0xe0, 0x00, 0xe0, 0x00,
        0xe7, 0xc0, 0xef, 0xe0, 0xf8, 0x70, 0xf0, 0x38,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x1c, 0x70, 0x38, 0x70, 0x38,
        0x38, 0x70, 0x3c, 0xf0, 0x1f, 0xe0, 0x07, 0x80,
    ])),
    '7': (14, bytes([
        0xff, 0xfc, 0xff, 0xfc, 0xff, 0xfc, 0x00, 0x38,
        0x00, 0x70, 0x00, 0x70, 0x00, 0xe0, 0x00, 0xe0,
        0x01, 0xc0, 0x01, 0xc0, 0x03, 0x80, 0x03, 0x80,
        0x07, 0x00, 0x07, 0x00, 0x0e, 0x00, 0x0e, 0x00,
        0x0e, 0x00, 0x1c, 0x00, 0x1c, 0x00, 0x1c, 0x00,
        0x1c, 0x00, 0x1c, 0x00, 0x1c, 0x00, 0x1c, 0x00,
    ])),
    '8': (14, bytes([
        0x0f, 0x80, 0x3f, 0xe0, 0x78, 0x78, 0x70, 0x38,
        0x60, 0x18, 0x60, 0x18, 0x70, 0x38, 0x78, 0x78,
        0x3f, 0xe0, 0x0f, 0x80, 0x0f, 0x80, 0x3f, 0xe0,
        0x78, 0x78, 0x70, 0x38, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0x70, 0x38,
        0x70, 0x38, 0x78, 0x78, 0x3f, 0xe0, 0x0f, 0x80,
    ])),
    '9': (14, bytes([
        0x0f, 0x80, 0x3f, 0xe0, 0x78, 0x70, 0x70, 0x38,
        0x60, 0x38, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x3c, 0x70, 0x7c, 0x78, 0xfc,
        0x3f, 0xdc, 0x1f, 0x1c, 0x00, 0x1c, 0x00, 0x1c,
        0x00, 0x38, 0x00, 0x38, 0x60, 0x70, 0x70, 0x70,
        0x38, 0xe0, 0x3f, 0xc0, 0x1f, 0x80, 0x0f, 0x00,
    ])),
    'A': (16, bytes([
        0x03, 0xc0, 0x03, 0xc0, 0x07, 0xe0, 0x07, 0xe0,
        0x06, 0x60, 0x0e, 0x70, 0x0e, 0x70, 0x0c, 0x30,
        0x1c, 0x38, 0x1c, 0x38, 0x18, 0x18, 0x38, 0x1c,
        0x3f, 0xfc, 0x3f, 0xfc, 0x7f, 0xfe, 0x70, 0x0e,
        0x60, 0x06, 0x60, 0x06, 0xe0, 0x07, 0xe0, 0x07,
        0xe0, 0x07, 0xe0, 0x07, 0xe0, 0x07, 0xe0, 0x07,
    ])),
    'N': (14, bytes([
        0xe0, 0x1c, 0xf0, 0x1c, 0xf0, 0x1c, 0xf8, 0x1c,
        0xf8, 0x1c, 0xec, 0x1c, 0xec, 0x1c, 0xe6, 0x1c,
        0xe6, 0x1c, 0xe7, 0x1c, 0xe3, 0x1c, 0xe3, 0x9c,
        0xe1, 0x9c, 0xe1, 0xdc, 0xe0, 0xdc, 0xe0, 0xfc,
        0xe0, 0xfc, 0xe0, 0x7c, 0xe0, 0x7c, 0xe0, 0x3c,
        0xe0, 0x3c, 0xe0, 0x3c, 0xe0, 0x1c, 0xe0, 0x1c,
    ])),
    'U': (14, bytes([
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c,
        0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0x70, 0x38,
        0x70, 0x38, 0x78, 0x78, 0x3f, 0xf0, 0x0f, 0xc0,
    ])),
}

# 16px font - for departure times
# Characters: 0-9, ', space
FONT_16_HEIGHT = 16

FONT_16 = {
    ' ': (5, bytes([
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    ])),
    '0': (10, bytes([
        0x1e, 0x00, 0x3f, 0x00, 0x73, 0x80, 0x61, 0x80,
        0xe1, 0xc0, 0xe1, 0xc0, 0xe1, 0xc0, 0xe1, 0xc0,
        0xe1, 0xc0, 0xe1, 0xc0, 0xe1, 0xc0, 0xe1, 0xc0,
        0x61, 0x80, 0x73, 0x80, 0x3f, 0x00, 0x1e, 0x00,
    ])),
    '1': (6, bytes([
        0x1c, 0x3c, 0x7c, 0x5c, 0x1c, 0x1c, 0x1c, 0x1c,
        0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x7f, 0x7f,
    ])),
    '2': (10, bytes([
        0x3e, 0x00, 0x7f, 0x00, 0x63, 0x80, 0x01, 0x80,
        0x01, 0x80, 0x03, 0x80, 0x07, 0x00, 0x0e, 0x00,
        0x1c, 0x00, 0x38, 0x00, 0x70, 0x00, 0x60, 0x00,
        0x60, 0x00, 0x60, 0x00, 0x7f, 0x80, 0x7f, 0x80,
    ])),
    '3': (10, bytes([
        0x3e, 0x00, 0x7f, 0x00, 0x43, 0x80, 0x01, 0x80,
        0x01, 0x80, 0x03, 0x00, 0x1e, 0x00, 0x1f, 0x00,
        0x03, 0x80, 0x01, 0x80, 0x01, 0xc0, 0x01, 0xc0,
        0x41, 0x80, 0x63, 0x80, 0x7f, 0x00, 0x3e, 0x00,
    ])),
    '4': (10, bytes([
        0x03, 0x80, 0x07, 0x80, 0x07, 0x80, 0x0f, 0x80,
        0x1b, 0x80, 0x1b, 0x80, 0x33, 0x80, 0x63, 0x80,
        0x63, 0x80, 0xff, 0xc0, 0xff, 0xc0, 0x03, 0x80,
        0x03, 0x80, 0x03, 0x80, 0x03, 0x80, 0x03, 0x80,
    ])),
    '5': (10, bytes([
        0x7f, 0x80, 0x7f, 0x80, 0x60, 0x00, 0x60, 0x00,
        0x60, 0x00, 0x7e, 0x00, 0x7f, 0x00, 0x03, 0x80,
        0x01, 0x80, 0x01, 0xc0, 0x01, 0xc0, 0x01, 0x80,
        0x41, 0x80, 0x63, 0x80, 0x7f, 0x00, 0x3e, 0x00,
    ])),
    '6': (10, bytes([
        0x0f, 0x00, 0x1f, 0x00, 0x38, 0x00, 0x70, 0x00,
        0x60, 0x00, 0x6e, 0x00, 0x7f, 0x00, 0x73, 0x80,
        0x61, 0x80, 0xe1, 0xc0, 0xe1, 0xc0, 0x61, 0x80,
        0x61, 0x80, 0x73, 0x80, 0x3f, 0x00, 0x1e, 0x00,
    ])),
    '7': (10, bytes([
        0xff, 0x80, 0xff, 0x80, 0x01, 0x80, 0x03, 0x00,
        0x03, 0x00, 0x06, 0x00, 0x06, 0x00, 0x0c, 0x00,
        0x0c, 0x00, 0x18, 0x00, 0x18, 0x00, 0x18, 0x00,
        0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00,
    ])),
    '8': (10, bytes([
        0x1e, 0x00, 0x3f, 0x00, 0x63, 0x80, 0x61, 0x80,
        0x61, 0x80, 0x73, 0x80, 0x3f, 0x00, 0x1e, 0x00,
        0x3f, 0x00, 0x73, 0x80, 0x61, 0x80, 0xe1, 0xc0,
        0xe1, 0xc0, 0x63, 0x80, 0x7f, 0x00, 0x1e, 0x00,
    ])),
    '9': (10, bytes([
        0x1e, 0x00, 0x3f, 0x00, 0x73, 0x80, 0x61, 0x80,
        0xe1, 0xc0, 0xe1, 0xc0, 0x61, 0x80, 0x73, 0xc0,
        0x3f, 0xc0, 0x1d, 0x80, 0x01, 0x80, 0x01, 0x80,
        0x03, 0x00, 0x07, 0x00, 0x3e, 0x00, 0x3c, 0x00,
    ])),
    "'": (4, bytes([
        0x60, 0x60, 0x60, 0x60, 0xc0, 0xc0, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    ])),
}


def draw_char_24(fb, x, y, char, color):
    """Draw a single 24px character to framebuffer."""
    if char not in FONT_24:
        return 0
    width, data = FONT_24[char]
    bytes_per_row = (width + 7) // 8

    for row in range(FONT_24_HEIGHT):
        for col in range(width):
            byte_idx = row * bytes_per_row + col // 8
            bit_idx = 7 - (col % 8)
            if byte_idx < len(data) and (data[byte_idx] >> bit_idx) & 1:
                fb.pixel(x + col, y + row, color)
    return width


def draw_char_16(fb, x, y, char, color):
    """Draw a single 16px character to framebuffer."""
    if char not in FONT_16:
        return 0
    width, data = FONT_16[char]
    bytes_per_row = (width + 7) // 8

    for row in range(FONT_16_HEIGHT):
        for col in range(width):
            byte_idx = row * bytes_per_row + col // 8
            bit_idx = 7 - (col % 8)
            if byte_idx < len(data) and (data[byte_idx] >> bit_idx) & 1:
                fb.pixel(x + col, y + row, color)
    return width


def draw_text_24(fb, x, y, text, color, spacing=2):
    """Draw text using 24px font. Returns total width."""
    cursor_x = x
    for char in text:
        width = draw_char_24(fb, cursor_x, y, char, color)
        cursor_x += width + spacing
    return cursor_x - x - spacing


def draw_text_16(fb, x, y, text, color, spacing=2):
    """Draw text using 16px font. Returns total width."""
    cursor_x = x
    for char in text:
        width = draw_char_16(fb, cursor_x, y, char, color)
        cursor_x += width + spacing
    return cursor_x - x - spacing


def get_text_width_24(text, spacing=2):
    """Calculate width of text in 24px font."""
    total = 0
    for char in text:
        if char in FONT_24:
            total += FONT_24[char][0] + spacing
    return max(0, total - spacing)


def get_text_width_16(text, spacing=2):
    """Calculate width of text in 16px font."""
    total = 0
    for char in text:
        if char in FONT_16:
            total += FONT_16[char][0] + spacing
    return max(0, total - spacing)
